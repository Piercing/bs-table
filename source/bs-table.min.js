angular.module("bsTable",[]).directive("bsTable",function(){return{restrict:"A",scope:true,compile:function(tElement,tAttrs){var header=angular.element("<thead><tr></tr></thead>"),headerRow=header.children("tr"),totalRows=0,tBodyRow=tElement.children("tbody").children("tr"),ngRepeatAttr=tBodyRow.attr("ng-repeat");tBodyRow.attr("ng-repeat",ngRepeatAttr+" | bsTableSkip:bsTableSortPagination.skipAt | orderBy:bsTableSortPagination.predicate:bsTableSortPagination.reverse | limitTo:bsTableSortPagination.pageSize");
angular.forEach(tBodyRow.children("td"),function(element){var column=angular.element(element),columnType=column.attr("data-type"),title=column.attr("data-title"),headerClick=column.attr("data-header-click");if(columnType=="command"){headerRow.append("<th "+(headerClick!=""&&headerClick!==undefined?'ng-click="'+headerClick+'"':"")+">"+title+"</th>");totalRows+=1;return}var expression=column.html(),expressionValue=expression.replace(/[{}\s]/g,""),name=expressionValue.split(/\.(.+)?/)[1].split(/\|/)[0],
filter=expressionValue.split(/\.(.+)?/)[1].split(/\|/)[1],filterAttr=!filter?"":'filter="'+filter+'"';headerRow.append("<th "+(headerClick!=""&&headerClick!==undefined?'ng-click="'+headerClick+'"':"")+' name="'+name+'" '+filterAttr+">"+title+'<span style="padding-left: 4px;"></span></th>');column.removeAttr("data-title");totalRows+=1});tElement.prepend(header);var footer='<tfoot><tr><td colspan="'+totalRows+'">'+'<ul class="pagination"></ul>'+'<select ng-model="bsTableSortPagination.pageSize" class="form-control select-page-size">'+
'<option value="5" selected="selected">5</option><option value="10">10</option><option value="20">20</option><option value="40">40</option></select>'+"</td></tr></tfoot>";tElement.append(footer);return{pre:function(scope,linkElement){var grid=scope.bsTableSortPagination={};var pager=linkElement.children("tfoot").children("tr").children("td"),collectionName=ngRepeatAttr.match(/^\s*(.+)\s+in\s+(.*)\s*$/)[2],collection=scope.$eval(collectionName),totalRows=collection.length;scope.$watchCollection(collectionName,
function(){totalRows=scope.$eval(collectionName).length;grid.lastPage=Math.ceil(totalRows/grid.pageSize);RenderPagination()});scope.$watch("bsTableSortPagination.pageSize",function(){RenderPagination()});grid.pageSize=5;grid.lastPage=Math.ceil(totalRows/grid.pageSize);grid.page=1;grid.skipAt=(grid.page-1)*grid.pageSize;pager.children(".select-page-size").change(function(){var gridLimit=parseInt($(this).val());grid.lastPage=Math.ceil(totalRows/gridLimit);grid.page=1;grid.skipAt=(grid.page-1)*gridLimit;
scope.$digest()});var RenderPagination=function(){var paging="";for(var i=0;i<Math.ceil(totalRows/scope.bsTableSortPagination.pageSize);i++)paging+="<li "+(grid.page==i+1?'class="active"':"")+'><a ng-href="#">'+(i+1)+"</a></li>";linkElement.find(".pagination").html(paging);linkElement.find(".pagination").find("li").bind("click",listenerPagination)};var listenerPagination=function(){var index=parseInt($(this).find("a").text());$(this).parent().find("li").removeClass("active");$(this).addClass("active");
grid.page=index;grid.skipAt=(grid.page-1)*grid.pageSize;scope.$digest()};var listenerOrder=function(){var sort=$(this).children("span");grid.predicate=$(this).attr("name");grid.reverse=false;if(!sort.hasClass("glyphicon glyphicon-chevron-up")&&!sort.hasClass("glyphicon glyphicon-chevron-down")){headerRow.children("th").children("span").removeClass("glyphicon glyphicon-chevron-up glyphicon glyphicon-chevron-down");sort.addClass("glyphicon glyphicon-chevron-up");grid.reverse=false}else{if(sort.hasClass("glyphicon glyphicon-chevron-up"))grid.reverse=
true;else grid.reverse=false;sort.toggleClass("glyphicon glyphicon-chevron-up");sort.toggleClass("glyphicon glyphicon-chevron-down")}scope.$digest()};var headerColumn=linkElement.children("thead").children("tr").children("th");angular.forEach(headerColumn,function(element){$(element).click(listenerOrder)})}}}}}).filter("bsTableSkip",function(){return function(array,skipAt){return array.slice(skipAt)}});
