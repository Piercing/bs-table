"use strict";angular.module("bsTable",[]).directive("bsTable",function(){return{restrict:"A",scope:true,compile:function(tElement,tAttrs){var totalCols=0,tBody=tElement.find("tbody"),tBodyRow=tBody.find("tr"),ngRepeatAttr=tBodyRow.attr("ng-repeat")!==undefined?tBodyRow.attr("ng-repeat"):tBody.attr("ng-repeat"),ngRepeatExtension=" | bsTableSkip:bsTablePagination.skipAt | limitTo:bsTablePagination.pageSize";tBodyRow.attr("ng-repeat")!==undefined?tBodyRow.attr("ng-repeat",ngRepeatAttr+ngRepeatExtension):tBody.attr("ng-repeat",ngRepeatAttr+ngRepeatExtension);totalCols=tBodyRow.children("td").size();var footer='<tfoot><tr><td colspan="'+totalCols+'"><ul class="pagination"></ul><select ng-model="bsTablePagination.pageSize" class="form-control select-page-size"><option value="5" selected="selected">5</option><option value="10">10</option><option value="20">20</option><option value="40">40</option></select></td></tr></tfoot>';tElement.append(footer);return{pre:function(scope,linkElement){var grid=scope.bsTablePagination={};var pager=linkElement.children("tfoot").children("tr").children("td"),collectionName=ngRepeatAttr.match(/^\s*(.+)\s+in\s+(.*)\s*$/)[2],collection=scope.$eval(collectionName),totalRows=collection.length;scope.$watchCollection(collectionName,function(){totalRows=scope.$eval(collectionName).length;grid.lastPage=Math.ceil(totalRows/grid.pageSize);RenderPagination()});scope.$watch("bsTablePagination.pageSize",function(){RenderPagination()});grid.pageSize=5;grid.lastPage=Math.ceil(totalRows/grid.pageSize);grid.page=1;grid.skipAt=(grid.page-1)*grid.pageSize;pager.children(".select-page-size").change(function(){var gridLimit=parseInt($(this).val());grid.lastPage=Math.ceil(totalRows/gridLimit);grid.page=1;grid.skipAt=(grid.page-1)*gridLimit;scope.$digest()});var RenderPagination=function(){var paging="";for(var i=0;i<Math.ceil(totalRows/scope.bsTablePagination.pageSize);i++){paging+="<li "+(grid.page==(i+1)?'class="active"':"")+'><a ng-href="#">'+(i+1)+"</a></li>"}linkElement.find(".pagination").html(paging);linkElement.find(".pagination").find("li").bind("click",ListenerPagination)};var ListenerPagination=function(){var index=parseInt($(this).find("a").text());$(this).parent().find("li").removeClass("active");$(this).addClass("active");grid.page=index;grid.skipAt=(grid.page-1)*grid.pageSize;scope.$digest()}}}}}}).filter("bsTableSkip",function(){return function(array,skipAt){return array.slice(skipAt)}});
